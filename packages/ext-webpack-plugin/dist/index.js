'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require('@babel/polyfill');

class ExtWebpackPlugin {
  constructor(options) {
    this.plugin = require(`./pluginUtil`)._constructor(options);
  }

  apply(compiler) {
    require('./pluginUtil').logv(this.plugin.options, 'FUNCTION apply');

    if (!compiler.hooks) {
      console.log('not webpack 4');
      return;
    }

    compiler.hooks.thisCompilation.tap(`ext-this-compilation`, compilation => {
      require('./pluginUtil').logv(this.plugin.options, 'HOOK thisCompilation');

      if (this.plugin.vars.pluginErrors.length > 0) {
        compilation.errors.push(new Error(this.plugin.vars.pluginErrors.join("")));
      }
    });

    if (this.plugin.vars.pluginErrors.length > 0) {
      return;
    }

    if (this.plugin.vars.framework == 'extjs') {
      compiler.hooks.compilation.tap(`ext-compilation`, compilation => {
        require('./pluginUtil').logv(this.plugin.options, 'HOOK compilation (empty)');
      });
      compiler.hooks.afterCompile.tap('ext-after-compile', compilation => {
        require('./pluginUtil').logv(this.plugin.options, 'HOOK afterCompile');

        require(`./extjsUtil`)._afterCompile(compilation, this.plugin.vars, this.plugin.options);
      });
    } else {
      compiler.hooks.compilation.tap(`ext-compilation`, compilation => {
        require('./pluginUtil').logv(this.plugin.options, 'HOOK compilation');

        require(`./pluginUtil`)._compilation(compiler, compilation, this.plugin.vars, this.plugin.options);
      });
      compiler.hooks.afterCompile.tap('ext-after-compile', compilation => {
        require('./pluginUtil').logv(this.plugin.options, 'HOOK afterCompile');

        require(`./pluginUtil`)._afterCompile(compiler, compilation, this.plugin.vars, this.plugin.options);
      });
    }

    if (this.plugin.options.genProdData == true && this.plugin.options.environment == 'production' || this.plugin.options.genProdData == false && this.plugin.options.environment != 'production') {
      compiler.hooks.emit.tapAsync(`ext-emit`, (compilation, callback) => {
        require('./pluginUtil').logv(this.plugin.options, 'HOOK emit');

        require(`./pluginUtil`).emit(compiler, compilation, this.plugin.vars, this.plugin.options, callback);
      });
    }

    compiler.hooks.done.tap(`ext-done`, () => {
      require('./pluginUtil').logv(this.plugin.options, 'HOOK done');

      require(`./pluginUtil`)._done(this.plugin.vars, this.plugin.options);

      require('./pluginUtil').log(this.plugin.vars.app + `Completed ext-webpack-plugin processing`);
    });
  }

}

exports.default = ExtWebpackPlugin;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiRXh0V2VicGFja1BsdWdpbiIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInBsdWdpbiIsIl9jb25zdHJ1Y3RvciIsImFwcGx5IiwiY29tcGlsZXIiLCJsb2d2IiwiaG9va3MiLCJjb25zb2xlIiwibG9nIiwidGhpc0NvbXBpbGF0aW9uIiwidGFwIiwiY29tcGlsYXRpb24iLCJ2YXJzIiwicGx1Z2luRXJyb3JzIiwibGVuZ3RoIiwiZXJyb3JzIiwicHVzaCIsIkVycm9yIiwiam9pbiIsImZyYW1ld29yayIsImFmdGVyQ29tcGlsZSIsIl9hZnRlckNvbXBpbGUiLCJfY29tcGlsYXRpb24iLCJnZW5Qcm9kRGF0YSIsImVudmlyb25tZW50IiwiZW1pdCIsInRhcEFzeW5jIiwiY2FsbGJhY2siLCJkb25lIiwiX2RvbmUiLCJhcHAiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBQ0FBLE9BQU8sQ0FBQyxpQkFBRCxDQUFQOztBQUNlLE1BQU1DLGdCQUFOLENBQXVCO0FBQ3BDQyxFQUFBQSxXQUFXLENBQUNDLE9BQUQsRUFBVTtBQUNuQixTQUFLQyxNQUFMLEdBQWNKLE9BQU8sQ0FBRSxjQUFGLENBQVAsQ0FBd0JLLFlBQXhCLENBQXFDRixPQUFyQyxDQUFkO0FBQ0Q7O0FBRURHLEVBQUFBLEtBQUssQ0FBQ0MsUUFBRCxFQUFXO0FBQ2RQLElBQUFBLE9BQU8sQ0FBQyxjQUFELENBQVAsQ0FBd0JRLElBQXhCLENBQTZCLEtBQUtKLE1BQUwsQ0FBWUQsT0FBekMsRUFBaUQsZ0JBQWpEOztBQUNBLFFBQUksQ0FBQ0ksUUFBUSxDQUFDRSxLQUFkLEVBQXFCO0FBQUNDLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGVBQVo7QUFBNkI7QUFBTzs7QUFFMURKLElBQUFBLFFBQVEsQ0FBQ0UsS0FBVCxDQUFlRyxlQUFmLENBQStCQyxHQUEvQixDQUFvQyxzQkFBcEMsRUFBNERDLFdBQUQsSUFBaUI7QUFD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QXBCLElBQW1DLFlBRG5GLEVBRUE7QUFDRXBCLE1BQUFBLFFBQVEsQ0FBQ0UsS0FBVCxDQUFlbUIsSUFBZixDQUFvQkMsUUFBcEIsQ0FBOEIsVUFBOUIsRUFBeUMsQ0FBQ2YsV0FBRCxFQUFjZ0IsUUFBZCxLQUEyQjtBQUNsRTlCLFFBQUFBLE9BQU8sQ0FBQyxjQUFELENBQVAsQ0FBd0JRLElBQXhCLENBQTZCLEtBQUtKLE1BQUwsQ0FBWUQsT0FBekMsRUFBaUQsV0FBakQ7O0FBQ0FILFFBQUFBLE9BQU8sQ0FBRSxjQUFGLENBQVAsQ0FBd0I0QixJQUF4QixDQUE2QnJCLFFBQTdCLEVBQXVDTyxXQUF2QyxFQUFvRCxLQUFLVixNQUFMLENBQVlXLElBQWhFLEVBQXNFLEtBQUtYLE1BQUwsQ0FBWUQsT0FBbEYsRUFBMkYyQixRQUEzRjtBQUNELE9BSEQ7QUFJRDs7QUFFRHZCLElBQUFBLFFBQVEsQ0FBQ0UsS0FBVCxDQUFlc0IsSUFBZixDQUFvQmxCLEdBQXBCLENBQXlCLFVBQXpCLEVBQW9DLE1BQU07QUFDeENiLE1BQUFBLE9BQU8sQ0FBQyxjQUFELENBQVAsQ0FBd0JRLElBQXhCLENBQTZCLEtBQUtKLE1BQUwsQ0FBWUQsT0FBekMsRUFBaUQsV0FBakQ7O0FBQ0FILE1BQUFBLE9BQU8sQ0FBRSxjQUFGLENBQVAsQ0FBd0JnQyxLQUF4QixDQUE4QixLQUFLNUIsTUFBTCxDQUFZVyxJQUExQyxFQUFnRCxLQUFLWCxNQUFMLENBQVlELE9BQTVEOztBQUNBSCxNQUFBQSxPQUFPLENBQUMsY0FBRCxDQUFQLENBQXdCVyxHQUF4QixDQUE0QixLQUFLUCxNQUFMLENBQVlXLElBQVosQ0FBaUJrQixHQUFqQixHQUF3Qix5Q0FBcEQ7QUFDRCxLQUpEO0FBS0Q7O0FBckRtQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xucmVxdWlyZSgnQGJhYmVsL3BvbHlmaWxsJylcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV4dFdlYnBhY2tQbHVnaW4ge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdGhpcy5wbHVnaW4gPSByZXF1aXJlKGAuL3BsdWdpblV0aWxgKS5fY29uc3RydWN0b3Iob3B0aW9ucylcbiAgfVxuXG4gIGFwcGx5KGNvbXBpbGVyKSB7XG4gICAgcmVxdWlyZSgnLi9wbHVnaW5VdGlsJykubG9ndih0aGlzLnBsdWdpbi5vcHRpb25zLCdGVU5DVElPTiBhcHBseScpXG4gICAgaWYgKCFjb21waWxlci5ob29rcykge2NvbnNvbGUubG9nKCdub3Qgd2VicGFjayA0Jyk7cmV0dXJufVxuXG4gICAgY29tcGlsZXIuaG9va3MudGhpc0NvbXBpbGF0aW9uLnRhcChgZXh0LXRoaXMtY29tcGlsYXRpb25gLCAoY29tcGlsYXRpb24pID0+IHtcbiAgICAgIHJlcXVpcmUoJy4vcGx1Z2luVXRpbCcpLmxvZ3YodGhpcy5wbHVnaW4ub3B0aW9ucywnSE9PSyB0aGlzQ29tcGlsYXRpb24nKVxuICAgICAgaWYgKHRoaXMucGx1Z2luLnZhcnMucGx1Z2luRXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29tcGlsYXRpb24uZXJyb3JzLnB1c2goIG5ldyBFcnJvcih0aGlzLnBsdWdpbi52YXJzLnBsdWdpbkVycm9ycy5qb2luKFwiXCIpKSApXG4gICAgICB9XG4gICAgfSlcbiAgICBpZiAodGhpcy5wbHVnaW4udmFycy5wbHVnaW5FcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgaWYgKCB0aGlzLnBsdWdpbi52YXJzLmZyYW1ld29yayA9PSAnZXh0anMnKSB7XG4gICAgICBjb21waWxlci5ob29rcy5jb21waWxhdGlvbi50YXAoYGV4dC1jb21waWxhdGlvbmAsIChjb21waWxhdGlvbikgPT4ge1xuICAgICAgICByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2KHRoaXMucGx1Z2luLm9wdGlvbnMsJ0hPT0sgY29tcGlsYXRpb24gKGVtcHR5KScpXG4gICAgICB9KVxuICAgICAgY29tcGlsZXIuaG9va3MuYWZ0ZXJDb21waWxlLnRhcCgnZXh0LWFmdGVyLWNvbXBpbGUnLCAoY29tcGlsYXRpb24pID0+IHtcbiAgICAgICAgcmVxdWlyZSgnLi9wbHVnaW5VdGlsJykubG9ndih0aGlzLnBsdWdpbi5vcHRpb25zLCdIT09LIGFmdGVyQ29tcGlsZScpXG4gICAgICAgIHJlcXVpcmUoYC4vZXh0anNVdGlsYCkuX2FmdGVyQ29tcGlsZShjb21waWxhdGlvbiwgdGhpcy5wbHVnaW4udmFycywgdGhpcy5wbHVnaW4ub3B0aW9ucylcbiAgICAgIH0pXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY29tcGlsZXIuaG9va3MuY29tcGlsYXRpb24udGFwKGBleHQtY29tcGlsYXRpb25gLCAoY29tcGlsYXRpb24pID0+IHtcbiAgICAgICAgcmVxdWlyZSgnLi9wbHVnaW5VdGlsJykubG9ndih0aGlzLnBsdWdpbi5vcHRpb25zLCdIT09LIGNvbXBpbGF0aW9uJylcbiAgICAgICAgcmVxdWlyZShgLi9wbHVnaW5VdGlsYCkuX2NvbXBpbGF0aW9uKGNvbXBpbGVyLCBjb21waWxhdGlvbiwgdGhpcy5wbHVnaW4udmFycywgdGhpcy5wbHVnaW4ub3B0aW9ucylcbiAgICAgIH0pXG4gICAgICBjb21waWxlci5ob29rcy5hZnRlckNvbXBpbGUudGFwKCdleHQtYWZ0ZXItY29tcGlsZScsIChjb21waWxhdGlvbikgPT4ge1xuICAgICAgICByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2KHRoaXMucGx1Z2luLm9wdGlvbnMsJ0hPT0sgYWZ0ZXJDb21waWxlJylcbiAgICAgICAgcmVxdWlyZShgLi9wbHVnaW5VdGlsYCkuX2FmdGVyQ29tcGlsZShjb21waWxlciwgY29tcGlsYXRpb24sIHRoaXMucGx1Z2luLnZhcnMsIHRoaXMucGx1Z2luLm9wdGlvbnMpXG4gICAgICB9KVxuICAgIH1cblxuICAgIGlmKCh0aGlzLnBsdWdpbi5vcHRpb25zLmdlblByb2REYXRhID09IHRydWUgJiYgdGhpcy5wbHVnaW4ub3B0aW9ucy5lbnZpcm9ubWVudCA9PSAncHJvZHVjdGlvbicpIHx8XG4gICAgICAgKHRoaXMucGx1Z2luLm9wdGlvbnMuZ2VuUHJvZERhdGEgPT0gZmFsc2UgJiYgdGhpcy5wbHVnaW4ub3B0aW9ucy5lbnZpcm9ubWVudCAhPSAncHJvZHVjdGlvbicpKVxuICAgIHtcbiAgICAgIGNvbXBpbGVyLmhvb2tzLmVtaXQudGFwQXN5bmMoYGV4dC1lbWl0YCwgKGNvbXBpbGF0aW9uLCBjYWxsYmFjaykgPT4ge1xuICAgICAgICByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2KHRoaXMucGx1Z2luLm9wdGlvbnMsJ0hPT0sgZW1pdCcpXG4gICAgICAgIHJlcXVpcmUoYC4vcGx1Z2luVXRpbGApLmVtaXQoY29tcGlsZXIsIGNvbXBpbGF0aW9uLCB0aGlzLnBsdWdpbi52YXJzLCB0aGlzLnBsdWdpbi5vcHRpb25zLCBjYWxsYmFjaylcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29tcGlsZXIuaG9va3MuZG9uZS50YXAoYGV4dC1kb25lYCwgKCkgPT4ge1xuICAgICAgcmVxdWlyZSgnLi9wbHVnaW5VdGlsJykubG9ndih0aGlzLnBsdWdpbi5vcHRpb25zLCdIT09LIGRvbmUnKVxuICAgICAgcmVxdWlyZShgLi9wbHVnaW5VdGlsYCkuX2RvbmUodGhpcy5wbHVnaW4udmFycywgdGhpcy5wbHVnaW4ub3B0aW9ucylcbiAgICAgIHJlcXVpcmUoJy4vcGx1Z2luVXRpbCcpLmxvZyh0aGlzLnBsdWdpbi52YXJzLmFwcCArIGBDb21wbGV0ZWQgZXh0LXdlYnBhY2stcGx1Z2luIHByb2Nlc3NpbmdgKVxuICAgIH0pXG4gIH1cbn1cbiJdfQ==