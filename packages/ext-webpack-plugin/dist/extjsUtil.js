"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getDefaultOptions = getDefaultOptions;
exports.getDefaultVars = getDefaultVars;
exports._afterCompile = _afterCompile;
exports._prepareForBuild = _prepareForBuild;
exports.extractFromSource = extractFromSource;

function getDefaultOptions() {
  return {
    port: 1962,
    profile: 'desktop',
    environment: 'development',
    verbose: 'no'
  };
}

function getDefaultVars() {
  return {
    firstTime: true,
    browserCount: 0,
    cwd: process.cwd(),
    extPath: '.',
    pluginErrors: [],
    lastNumFiles: 0,
    lastMilliseconds: 0,
    lastMillisecondsAppJson: 0,
    files: ['./app.json'],
    dirs: ['./app', './packages']
  };
}

function _afterCompile(compilation, vars, options) {
  const logv = require('./pluginUtil').logv;

  logv(options, 'FUNCTION ext-after-compile');

  const path = require('path');

  let {
    files,
    dirs
  } = vars;
  const {
    cwd
  } = vars;
  files = typeof files === 'string' ? [files] : files;
  dirs = typeof dirs === 'string' ? [dirs] : dirs;

  const {
    fileDependencies,
    contextDependencies
  } = _getFileAndContextDeps(compilation, files, dirs, cwd);

  if (files.length > 0) {
    fileDependencies.forEach(file => {
      compilation.fileDependencies.add(path.resolve(file));
    });
  }

  if (dirs.length > 0) {
    contextDependencies.forEach(context => {
      compilation.contextDependencies.add(context);
    });
  }
}

function _getFileAndContextDeps(compilation, files, dirs, cwd) {
  //const log = require('./pluginUtil').log
  const uniq = require('lodash.uniq');

  const isGlob = require('is-glob');

  const {
    fileDependencies,
    contextDependencies
  } = compilation;
  const isWebpack4 = compilation.hooks;
  let fds = isWebpack4 ? [...fileDependencies] : fileDependencies;
  let cds = isWebpack4 ? [...contextDependencies] : contextDependencies;

  if (files.length > 0) {
    files.forEach(pattern => {
      let f = pattern;

      if (isGlob(pattern)) {
        f = glob.sync(pattern, {
          cwd,
          dot: true,
          absolute: true
        });
      }

      fds = fds.concat(f);
    });
    fds = uniq(fds);
  }

  if (dirs.length > 0) {
    cds = uniq(cds.concat(dirs));
  }

  return {
    fileDependencies: fds,
    contextDependencies: cds
  };
}

function _prepareForBuild(app, vars, options, output, compilation) {
  const log = require('./pluginUtil').log;

  const logv = require('./pluginUtil').logv;

  logv(options, '_prepareForBuild');

  const fs = require('fs');

  const recursiveReadSync = require('recursive-readdir-sync');

  var watchedFiles = [];

  try {
    watchedFiles = recursiveReadSync('./app').concat(recursiveReadSync('./packages'));
  } catch (err) {
    if (err.errno === 34) {
      console.log('Path does not exist');
    } else {
      throw err;
    }
  }

  var currentNumFiles = watchedFiles.length;
  logv(options, 'watchedFiles: ' + currentNumFiles);
  var doBuild = false;

  for (var file in watchedFiles) {
    if (vars.lastMilliseconds < fs.statSync(watchedFiles[file]).mtimeMs) {
      if (watchedFiles[file].indexOf("scss") != -1) {
        doBuild = true;
        break;
      }
    }
  }

  if (vars.lastMilliseconds < fs.statSync('./app.json').mtimeMs) {
    doBuild = true;
  }

  logv(options, 'doBuild: ' + doBuild);
  vars.lastMilliseconds = new Date().getTime();
  var filesource = 'this file enables client reload';
  compilation.assets[currentNumFiles + 'FilesUnderAppFolder.md'] = {
    source: function () {
      return filesource;
    },
    size: function () {
      return filesource.length;
    } //if(options.verbose == 'yes') {log('-v-' + app + 'currentNumFiles: ' + currentNumFiles)}
    //if(options.verbose == 'yes') {log('-v-' + app + 'vars.lastNumFiles: ' + vars.lastNumFiles)}
    //if(options.verbose == 'yes') {log('-v-' + app + 'doBuild: ' + doBuild)}

  };

  if (currentNumFiles != vars.lastNumFiles || doBuild) {
    vars.rebuild = true;
    log(app + 'building Ext bundle at: ' + output.replace(process.cwd(), ''));
  } else {
    vars.rebuild = false;
  }

  vars.lastNumFiles = currentNumFiles;
}

function toXtype(str) {
  return str.toLowerCase().replace(/_/g, '-');
}

function extractFromSource(js) {
  const log = require('./pluginUtil').log;

  var generate = require("@babel/generator").default;

  var parse = require("babylon").parse;

  var traverse = require("ast-traverse");

  const statements = [];
  const ast = parse(js, {
    plugins: ['jsx', 'flow', 'doExpressions', 'objectRestSpread', 'classProperties', 'exportExtensions', 'asyncGenerators', 'functionBind', 'functionSent', 'dynamicImport'],
    sourceType: 'module'
  });

  function addType(argNode) {
    var type;

    if (argNode.type === 'StringLiteral') {
      var xtype = toXtype(argNode.value);

      if (xtype != 'extreact') {
        type = {
          xtype: toXtype(argNode.value)
        };
      }
    } else {
      type = {
        xclass: js.slice(argNode.start, argNode.end)
      };
    }

    if (type != undefined) {
      let config = JSON.stringify(type);
      statements.push(`Ext.create(${config})`);
    }
  }

  traverse(ast, {
    pre: function (node) {
      if (node.type === 'CallExpression' && node.callee && node.callee.object && node.callee.object.name === 'Ext') {
        statements.push(generate(node).code);
      }

      if (node.type == 'VariableDeclarator' && node.init && node.init.type === 'CallExpression' && node.init.callee) {
        if (node.init.callee.name == 'reactify') {
          for (let i = 0; i < node.init.arguments.length; i++) {
            const valueNode = node.init.arguments[i];
            if (!valueNode) continue;
            addType(valueNode);
          }
        }
      } // // Convert React.createElement(...) calls to the equivalent Ext.create(...) calls to put in the manifest.
      // if (node.type === 'CallExpressionx' 
      //     && node.callee.object 
      //     && node.callee.object.name === 'React' 
      //     && node.callee.property.name === 'createElement') {
      //   const [props] = node.arguments
      //   let config
      //   if (Array.isArray(props.properties)) {
      //     config = generate(props).code
      //     for (let key in type) {
      //       config = `{\n  ${key}: '${type[key]}',${config.slice(1)}`
      //     }
      //   } else {
      //     config = JSON.stringify(type)
      //   }
      // }

    }
  });
  return statements;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9leHRqc1V0aWwuanMiXSwibmFtZXMiOlsiZ2V0RGVmYXVsdE9wdGlvbnMiLCJwb3J0IiwicHJvZmlsZSIsImVudmlyb25tZW50IiwidmVyYm9zZSIsImdldERlZmF1bHRWYXJzIiwiZmlyc3RUaW1lIiwiYnJvd3NlckNvdW50IiwiY3dkIiwicHJvY2VzcyIsImV4dFBhdGgiLCJwbHVnaW5FcnJvcnMiLCJsYXN0TnVtRmlsZXMiLCJsYXN0TWlsbGlzZWNvbmRzIiwibGFzdE1pbGxpc2Vjb25kc0FwcEpzb24iLCJmaWxlcyIsImRpcnMiLCJfYWZ0ZXJDb21waWxlIiwiY29tcGlsYXRpb24iLCJ2YXJzIiwib3B0aW9ucyIsImxvZ3YiLCJyZXF1aXJlIiwicGF0aCIsImZpbGVEZXBlbmRlbmNpZXMiLCJjb250ZXh0RGVwZW5kZW5jaWVzIiwiX2dldEZpbGVBbmRDb250ZXh0RGVwcyIsImxlbmd0aCIsImZvckVhY2giLCJmaWxlIiwiYWRkIiwicmVzb2x2ZSIsImNvbnRleHQiLCJ1bmlxIiwiaXNHbG9iIiwiaXNXZWJwYWNrNCIsImhvb2tzIiwiZmRzIiwiY2RzIiwicGF0dGVybiIsImYiLCJnbG9iIiwic3luYyIsImRvdCIsImFic29sdXRlIiwiY29uY2F0IiwiX3ByZXBhcmVGb3JCdWlsZCIsImFwcCIsIm91dHB1dCIsImxvZyIsImZzIiwicmVjdXJzaXZlUmVhZFN5bmMiLCJ3YXRjaGVkRmlsZXMiLCJlcnIiLCJlcnJubyIsImNvbnNvbGUiLCJjdXJyZW50TnVtRmlsZXMiLCJkb0J1aWxkIiwic3RhdFN5bmMiLCJtdGltZU1zIiwiaW5kZXhPZiIsIkRhdGUiLCJnZXRUaW1lIiwiZmlsZXNvdXJjZSIsImFzc2V0cyIsInNvdXJjZSIsInNpemUiLCJyZWJ1aWxkIiwicmVwbGFjZSIsInRvWHR5cGUiLCJzdHIiLCJ0b0xvd2VyQ2FzZSIsImV4dHJhY3RGcm9tU291cmNlIiwianMiLCJnZW5lcmF0ZSIsImRlZmF1bHQiLCJwYXJzZSIsInRyYXZlcnNlIiwic3RhdGVtZW50cyIsImFzdCIsInBsdWdpbnMiLCJzb3VyY2VUeXBlIiwiYWRkVHlwZSIsImFyZ05vZGUiLCJ0eXBlIiwieHR5cGUiLCJ2YWx1ZSIsInhjbGFzcyIsInNsaWNlIiwic3RhcnQiLCJlbmQiLCJ1bmRlZmluZWQiLCJjb25maWciLCJKU09OIiwic3RyaW5naWZ5IiwicHVzaCIsInByZSIsIm5vZGUiLCJjYWxsZWUiLCJvYmplY3QiLCJuYW1lIiwiY29kZSIsImluaXQiLCJpIiwiYXJndW1lbnRzIiwidmFsdWVOb2RlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7QUFFTyxTQUFTQSxpQkFBVCxHQUE2QjtBQUNsQyxTQUFPO0FBQ0xDLElBQUFBLElBQUksRUFBRSxJQUREO0FBRUxDLElBQUFBLE9BQU8sRUFBRSxTQUZKO0FBR0xDLElBQUFBLFdBQVcsRUFBRSxhQUhSO0FBSUxDLElBQUFBLE9BQU8sRUFBRTtBQUpKLEdBQVA7QUFPRDs7QUFFTSxTQUFTQyxjQUFULEdBQTBCO0FBQy9CLFNBQU87QUFDTEMsSUFBQUEsU0FBUyxFQUFHLElBRFA7QUFFTEMsSUFBQUEsWUFBWSxFQUFHLENBRlY7QUFHTEMsSUFBQUEsR0FBRyxFQUFFQyxPQUFPLENBQUNELEdBQVIsRUFIQTtBQUlMRSxJQUFBQSxPQUFPLEVBQUUsR0FKSjtBQUtMQyxJQUFBQSxZQUFZLEVBQUUsRUFMVDtBQU1MQyxJQUFBQSxZQUFZLEVBQUUsQ0FOVDtBQU9MQyxJQUFBQSxnQkFBZ0IsRUFBRSxDQVBiO0FBUUxDLElBQUFBLHVCQUF1QixFQUFFLENBUnBCO0FBU0xDLElBQUFBLEtBQUssRUFBRSxDQUFDLFlBQUQsQ0FURjtBQVVMQyxJQUFBQSxJQUFJLEVBQUUsQ0FBQyxPQUFELEVBQVMsWUFBVDtBQVZELEdBQVA7QUFZRDs7QUFFTSxTQUFTQyxhQUFULENBQXVCQyxXQUF2QixFQUFvQ0MsSUFBcEMsRUFBMENDLE9BQTFDLEVBQW1EO0FBQ3hELFFBQU1DLElBQUksR0FBR0MsT0FBTyxDQUFDLGNBQUQsQ0FBUCxDQUF3QkQsSUFBckM7O0FBQ0FBLEVBQUFBLElBQUksQ0FBQ0QsT0FBRCxFQUFTLDRCQUFULENBQUo7O0FBQ0EsUUFBTUcsSUFBSSxHQUFHRCxPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxNQUFJO0FBQUVQLElBQUFBLEtBQUY7QUFBU0MsSUFBQUE7QUFBVCxNQUFrQkcsSUFBdEI7QUFDQSxRQUFNO0FBQUVYLElBQUFBO0FBQUYsTUFBVVcsSUFBaEI7QUFDQUosRUFBQUEsS0FBSyxHQUFHLE9BQU9BLEtBQVAsS0FBaUIsUUFBakIsR0FBNEIsQ0FBQ0EsS0FBRCxDQUE1QixHQUFzQ0EsS0FBOUM7QUFDQUMsRUFBQUEsSUFBSSxHQUFHLE9BQU9BLElBQVAsS0FBZ0IsUUFBaEIsR0FBMkIsQ0FBQ0EsSUFBRCxDQUEzQixHQUFvQ0EsSUFBM0M7O0FBQ0EsUUFBTTtBQUNKUSxJQUFBQSxnQkFESTtBQUVKQyxJQUFBQTtBQUZJLE1BR0ZDLHNCQUFzQixDQUFDUixXQUFELEVBQWNILEtBQWQsRUFBcUJDLElBQXJCLEVBQTJCUixHQUEzQixDQUgxQjs7QUFJQSxNQUFJTyxLQUFLLENBQUNZLE1BQU4sR0FBZSxDQUFuQixFQUFzQjtBQUNwQkgsSUFBQUEsZ0JBQWdCLENBQUNJLE9BQWpCLENBQTBCQyxJQUFELElBQVU7QUFDakNYLE1BQUFBLFdBQVcsQ0FBQ00sZ0JBQVosQ0FBNkJNLEdBQTdCLENBQWlDUCxJQUFJLENBQUNRLE9BQUwsQ0FBYUYsSUFBYixDQUFqQztBQUNELEtBRkQ7QUFHRDs7QUFDRCxNQUFJYixJQUFJLENBQUNXLE1BQUwsR0FBYyxDQUFsQixFQUFxQjtBQUNuQkYsSUFBQUEsbUJBQW1CLENBQUNHLE9BQXBCLENBQTZCSSxPQUFELElBQWE7QUFDdkNkLE1BQUFBLFdBQVcsQ0FBQ08sbUJBQVosQ0FBZ0NLLEdBQWhDLENBQW9DRSxPQUFwQztBQUNELEtBRkQ7QUFHRDtBQUNGOztBQUdELFNBQVNOLHNCQUFULENBQWdDUixXQUFoQyxFQUE2Q0gsS0FBN0MsRUFBb0RDLElBQXBELEVBQTBEUixHQUExRCxFQUErRDtBQUM3RDtBQUNBLFFBQU15QixJQUFJLEdBQUdYLE9BQU8sQ0FBQyxhQUFELENBQXBCOztBQUNBLFFBQU1ZLE1BQU0sR0FBR1osT0FBTyxDQUFDLFNBQUQsQ0FBdEI7O0FBRUEsUUFBTTtBQUFFRSxJQUFBQSxnQkFBRjtBQUFvQkMsSUFBQUE7QUFBcEIsTUFBNENQLFdBQWxEO0FBQ0EsUUFBTWlCLFVBQVUsR0FBR2pCLFdBQVcsQ0FBQ2tCLEtBQS9CO0FBQ0EsTUFBSUMsR0FBRyxHQUFHRixVQUFVLEdBQUcsQ0FBQyxHQUFHWCxnQkFBSixDQUFILEdBQTJCQSxnQkFBL0M7QUFDQSxNQUFJYyxHQUFHLEdBQUdILFVBQVUsR0FBRyxDQUFDLEdBQUdWLG1CQUFKLENBQUgsR0FBOEJBLG1CQUFsRDs7QUFDQSxNQUFJVixLQUFLLENBQUNZLE1BQU4sR0FBZSxDQUFuQixFQUFzQjtBQUNwQlosSUFBQUEsS0FBSyxDQUFDYSxPQUFOLENBQWVXLE9BQUQsSUFBYTtBQUN6QixVQUFJQyxDQUFDLEdBQUdELE9BQVI7O0FBQ0EsVUFBSUwsTUFBTSxDQUFDSyxPQUFELENBQVYsRUFBcUI7QUFDbkJDLFFBQUFBLENBQUMsR0FBR0MsSUFBSSxDQUFDQyxJQUFMLENBQVVILE9BQVYsRUFBbUI7QUFBRS9CLFVBQUFBLEdBQUY7QUFBT21DLFVBQUFBLEdBQUcsRUFBRSxJQUFaO0FBQWtCQyxVQUFBQSxRQUFRLEVBQUU7QUFBNUIsU0FBbkIsQ0FBSjtBQUNEOztBQUNEUCxNQUFBQSxHQUFHLEdBQUdBLEdBQUcsQ0FBQ1EsTUFBSixDQUFXTCxDQUFYLENBQU47QUFDRCxLQU5EO0FBT0FILElBQUFBLEdBQUcsR0FBR0osSUFBSSxDQUFDSSxHQUFELENBQVY7QUFDRDs7QUFDRCxNQUFJckIsSUFBSSxDQUFDVyxNQUFMLEdBQWMsQ0FBbEIsRUFBcUI7QUFDbkJXLElBQUFBLEdBQUcsR0FBR0wsSUFBSSxDQUFDSyxHQUFHLENBQUNPLE1BQUosQ0FBVzdCLElBQVgsQ0FBRCxDQUFWO0FBQ0Q7O0FBQ0QsU0FBTztBQUFFUSxJQUFBQSxnQkFBZ0IsRUFBRWEsR0FBcEI7QUFBeUJaLElBQUFBLG1CQUFtQixFQUFFYTtBQUE5QyxHQUFQO0FBQ0Q7O0FBSU0sU0FBU1EsZ0JBQVQsQ0FBMEJDLEdBQTFCLEVBQStCNUIsSUFBL0IsRUFBcUNDLE9BQXJDLEVBQThDNEIsTUFBOUMsRUFBc0Q5QixXQUF0RCxFQUFtRTtBQUN4RSxRQUFNK0IsR0FBRyxHQUFHM0IsT0FBTyxDQUFDLGNBQUQsQ0FBUCxDQUF3QjJCLEdBQXBDOztBQUNBLFFBQU01QixJQUFJLEdBQUdDLE9BQU8sQ0FBQyxjQUFELENBQVAsQ0FBd0JELElBQXJDOztBQUNBQSxFQUFBQSxJQUFJLENBQUNELE9BQUQsRUFBUyxrQkFBVCxDQUFKOztBQUNBLFFBQU04QixFQUFFLEdBQUc1QixPQUFPLENBQUMsSUFBRCxDQUFsQjs7QUFDQSxRQUFNNkIsaUJBQWlCLEdBQUc3QixPQUFPLENBQUMsd0JBQUQsQ0FBakM7O0FBQ0EsTUFBSThCLFlBQVksR0FBQyxFQUFqQjs7QUFDQSxNQUFJO0FBQUNBLElBQUFBLFlBQVksR0FBR0QsaUJBQWlCLENBQUMsT0FBRCxDQUFqQixDQUEyQk4sTUFBM0IsQ0FBa0NNLGlCQUFpQixDQUFDLFlBQUQsQ0FBbkQsQ0FBZjtBQUFrRixHQUF2RixDQUNBLE9BQU1FLEdBQU4sRUFBVztBQUFDLFFBQUdBLEdBQUcsQ0FBQ0MsS0FBSixLQUFjLEVBQWpCLEVBQW9CO0FBQUNDLE1BQUFBLE9BQU8sQ0FBQ04sR0FBUixDQUFZLHFCQUFaO0FBQW9DLEtBQXpELE1BQStEO0FBQUMsWUFBTUksR0FBTjtBQUFXO0FBQUM7O0FBQ3hGLE1BQUlHLGVBQWUsR0FBR0osWUFBWSxDQUFDekIsTUFBbkM7QUFDQU4sRUFBQUEsSUFBSSxDQUFDRCxPQUFELEVBQVMsbUJBQW1Cb0MsZUFBNUIsQ0FBSjtBQUNBLE1BQUlDLE9BQU8sR0FBRyxLQUFkOztBQUNBLE9BQUssSUFBSTVCLElBQVQsSUFBaUJ1QixZQUFqQixFQUErQjtBQUM3QixRQUFJakMsSUFBSSxDQUFDTixnQkFBTCxHQUF3QnFDLEVBQUUsQ0FBQ1EsUUFBSCxDQUFZTixZQUFZLENBQUN2QixJQUFELENBQXhCLEVBQWdDOEIsT0FBNUQsRUFBcUU7QUFDbkUsVUFBSVAsWUFBWSxDQUFDdkIsSUFBRCxDQUFaLENBQW1CK0IsT0FBbkIsQ0FBMkIsTUFBM0IsS0FBc0MsQ0FBQyxDQUEzQyxFQUE4QztBQUFDSCxRQUFBQSxPQUFPLEdBQUMsSUFBUjtBQUFhO0FBQU87QUFDcEU7QUFDRjs7QUFDRCxNQUFJdEMsSUFBSSxDQUFDTixnQkFBTCxHQUF3QnFDLEVBQUUsQ0FBQ1EsUUFBSCxDQUFZLFlBQVosRUFBMEJDLE9BQXRELEVBQStEO0FBQzdERixJQUFBQSxPQUFPLEdBQUMsSUFBUjtBQUNEOztBQUNEcEMsRUFBQUEsSUFBSSxDQUFDRCxPQUFELEVBQVMsY0FBY3FDLE9BQXZCLENBQUo7QUFFQXRDLEVBQUFBLElBQUksQ0FBQ04sZ0JBQUwsR0FBeUIsSUFBSWdELElBQUosRUFBRCxDQUFXQyxPQUFYLEVBQXhCO0FBQ0EsTUFBSUMsVUFBVSxHQUFHLGlDQUFqQjtBQUNBN0MsRUFBQUEsV0FBVyxDQUFDOEMsTUFBWixDQUFtQlIsZUFBZSxHQUFHLHdCQUFyQyxJQUFpRTtBQUMvRFMsSUFBQUEsTUFBTSxFQUFFLFlBQVc7QUFBQyxhQUFPRixVQUFQO0FBQWtCLEtBRHlCO0FBRS9ERyxJQUFBQSxJQUFJLEVBQUUsWUFBVztBQUFDLGFBQU9ILFVBQVUsQ0FBQ3BDLE1BQWxCO0FBQXlCLEtBRm9CLENBS2pFO0FBQ0E7QUFDQTs7QUFQaUUsR0FBakU7O0FBU0EsTUFBSTZCLGVBQWUsSUFBSXJDLElBQUksQ0FBQ1AsWUFBeEIsSUFBd0M2QyxPQUE1QyxFQUFxRDtBQUNuRHRDLElBQUFBLElBQUksQ0FBQ2dELE9BQUwsR0FBZSxJQUFmO0FBQ0FsQixJQUFBQSxHQUFHLENBQUNGLEdBQUcsR0FBRywwQkFBTixHQUFtQ0MsTUFBTSxDQUFDb0IsT0FBUCxDQUFlM0QsT0FBTyxDQUFDRCxHQUFSLEVBQWYsRUFBOEIsRUFBOUIsQ0FBcEMsQ0FBSDtBQUNELEdBSEQsTUFJSztBQUNIVyxJQUFBQSxJQUFJLENBQUNnRCxPQUFMLEdBQWUsS0FBZjtBQUNEOztBQUNEaEQsRUFBQUEsSUFBSSxDQUFDUCxZQUFMLEdBQW9CNEMsZUFBcEI7QUFDRDs7QUFJRCxTQUFTYSxPQUFULENBQWlCQyxHQUFqQixFQUFzQjtBQUNwQixTQUFPQSxHQUFHLENBQUNDLFdBQUosR0FBa0JILE9BQWxCLENBQTBCLElBQTFCLEVBQWdDLEdBQWhDLENBQVA7QUFDRDs7QUFFTSxTQUFTSSxpQkFBVCxDQUEyQkMsRUFBM0IsRUFBK0I7QUFDcEMsUUFBTXhCLEdBQUcsR0FBRzNCLE9BQU8sQ0FBQyxjQUFELENBQVAsQ0FBd0IyQixHQUFwQzs7QUFDQSxNQUFJeUIsUUFBUSxHQUFHcEQsT0FBTyxDQUFDLGtCQUFELENBQVAsQ0FBNEJxRCxPQUEzQzs7QUFDQSxNQUFJQyxLQUFLLEdBQUd0RCxPQUFPLENBQUMsU0FBRCxDQUFQLENBQW1Cc0QsS0FBL0I7O0FBQ0EsTUFBSUMsUUFBUSxHQUFHdkQsT0FBTyxDQUFDLGNBQUQsQ0FBdEI7O0FBQ0EsUUFBTXdELFVBQVUsR0FBRyxFQUFuQjtBQUVBLFFBQU1DLEdBQUcsR0FBR0gsS0FBSyxDQUFDSCxFQUFELEVBQUs7QUFDcEJPLElBQUFBLE9BQU8sRUFBRSxDQUNQLEtBRE8sRUFFUCxNQUZPLEVBR1AsZUFITyxFQUlQLGtCQUpPLEVBS1AsaUJBTE8sRUFNUCxrQkFOTyxFQU9QLGlCQVBPLEVBUVAsY0FSTyxFQVNQLGNBVE8sRUFVUCxlQVZPLENBRFc7QUFhcEJDLElBQUFBLFVBQVUsRUFBRTtBQWJRLEdBQUwsQ0FBakI7O0FBZ0JBLFdBQVNDLE9BQVQsQ0FBaUJDLE9BQWpCLEVBQTBCO0FBQ3hCLFFBQUlDLElBQUo7O0FBQ0EsUUFBSUQsT0FBTyxDQUFDQyxJQUFSLEtBQWlCLGVBQXJCLEVBQXNDO0FBQ3BDLFVBQUlDLEtBQUssR0FBR2hCLE9BQU8sQ0FBQ2MsT0FBTyxDQUFDRyxLQUFULENBQW5COztBQUNBLFVBQUlELEtBQUssSUFBSSxVQUFiLEVBQXlCO0FBQ3ZCRCxRQUFBQSxJQUFJLEdBQUc7QUFBRUMsVUFBQUEsS0FBSyxFQUFFaEIsT0FBTyxDQUFDYyxPQUFPLENBQUNHLEtBQVQ7QUFBaEIsU0FBUDtBQUNEO0FBQ0YsS0FMRCxNQUtPO0FBQ0xGLE1BQUFBLElBQUksR0FBRztBQUFFRyxRQUFBQSxNQUFNLEVBQUVkLEVBQUUsQ0FBQ2UsS0FBSCxDQUFTTCxPQUFPLENBQUNNLEtBQWpCLEVBQXdCTixPQUFPLENBQUNPLEdBQWhDO0FBQVYsT0FBUDtBQUNEOztBQUNELFFBQUlOLElBQUksSUFBSU8sU0FBWixFQUF1QjtBQUNyQixVQUFJQyxNQUFNLEdBQUdDLElBQUksQ0FBQ0MsU0FBTCxDQUFlVixJQUFmLENBQWI7QUFDQU4sTUFBQUEsVUFBVSxDQUFDaUIsSUFBWCxDQUFpQixjQUFhSCxNQUFPLEdBQXJDO0FBQ0Q7QUFDRjs7QUFFRGYsRUFBQUEsUUFBUSxDQUFDRSxHQUFELEVBQU07QUFDWmlCLElBQUFBLEdBQUcsRUFBRSxVQUFTQyxJQUFULEVBQWU7QUFDbEIsVUFBSUEsSUFBSSxDQUFDYixJQUFMLEtBQWMsZ0JBQWQsSUFDR2EsSUFBSSxDQUFDQyxNQURSLElBRUdELElBQUksQ0FBQ0MsTUFBTCxDQUFZQyxNQUZmLElBR0dGLElBQUksQ0FBQ0MsTUFBTCxDQUFZQyxNQUFaLENBQW1CQyxJQUFuQixLQUE0QixLQUhuQyxFQUlFO0FBQ0F0QixRQUFBQSxVQUFVLENBQUNpQixJQUFYLENBQWdCckIsUUFBUSxDQUFDdUIsSUFBRCxDQUFSLENBQWVJLElBQS9CO0FBQ0Q7O0FBQ0QsVUFBSUosSUFBSSxDQUFDYixJQUFMLElBQWEsb0JBQWIsSUFDR2EsSUFBSSxDQUFDSyxJQURSLElBRUdMLElBQUksQ0FBQ0ssSUFBTCxDQUFVbEIsSUFBVixLQUFtQixnQkFGdEIsSUFHR2EsSUFBSSxDQUFDSyxJQUFMLENBQVVKLE1BSGpCLEVBSUU7QUFDQSxZQUFJRCxJQUFJLENBQUNLLElBQUwsQ0FBVUosTUFBVixDQUFpQkUsSUFBakIsSUFBeUIsVUFBN0IsRUFBeUM7QUFDdkMsZUFBSyxJQUFJRyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHTixJQUFJLENBQUNLLElBQUwsQ0FBVUUsU0FBVixDQUFvQjdFLE1BQXhDLEVBQWdENEUsQ0FBQyxFQUFqRCxFQUFxRDtBQUNuRCxrQkFBTUUsU0FBUyxHQUFHUixJQUFJLENBQUNLLElBQUwsQ0FBVUUsU0FBVixDQUFvQkQsQ0FBcEIsQ0FBbEI7QUFDQSxnQkFBSSxDQUFDRSxTQUFMLEVBQWdCO0FBQ2hCdkIsWUFBQUEsT0FBTyxDQUFDdUIsU0FBRCxDQUFQO0FBQ0Q7QUFDRDtBQUNILE9BcEJpQixDQXNCbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0Q7QUF2Q1csR0FBTixDQUFSO0FBeUNBLFNBQU8zQixVQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIlxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdE9wdGlvbnMoKSB7XG4gIHJldHVybiB7XG4gICAgcG9ydDogMTk2MixcbiAgICBwcm9maWxlOiAnZGVza3RvcCcsIFxuICAgIGVudmlyb25tZW50OiAnZGV2ZWxvcG1lbnQnLCBcbiAgICB2ZXJib3NlOiAnbm8nXG5cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdFZhcnMoKSB7XG4gIHJldHVybiB7XG4gICAgZmlyc3RUaW1lIDogdHJ1ZSxcbiAgICBicm93c2VyQ291bnQgOiAwLFxuICAgIGN3ZDogcHJvY2Vzcy5jd2QoKSxcbiAgICBleHRQYXRoOiAnLicsXG4gICAgcGx1Z2luRXJyb3JzOiBbXSxcbiAgICBsYXN0TnVtRmlsZXM6IDAsXG4gICAgbGFzdE1pbGxpc2Vjb25kczogMCxcbiAgICBsYXN0TWlsbGlzZWNvbmRzQXBwSnNvbjogMCxcbiAgICBmaWxlczogWycuL2FwcC5qc29uJ10sXG4gICAgZGlyczogWycuL2FwcCcsJy4vcGFja2FnZXMnXVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfYWZ0ZXJDb21waWxlKGNvbXBpbGF0aW9uLCB2YXJzLCBvcHRpb25zKSB7XG4gIGNvbnN0IGxvZ3YgPSByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2XG4gIGxvZ3Yob3B0aW9ucywnRlVOQ1RJT04gZXh0LWFmdGVyLWNvbXBpbGUnKVxuICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpXG4gIGxldCB7IGZpbGVzLCBkaXJzIH0gPSB2YXJzXG4gIGNvbnN0IHsgY3dkIH0gPSB2YXJzXG4gIGZpbGVzID0gdHlwZW9mIGZpbGVzID09PSAnc3RyaW5nJyA/IFtmaWxlc10gOiBmaWxlc1xuICBkaXJzID0gdHlwZW9mIGRpcnMgPT09ICdzdHJpbmcnID8gW2RpcnNdIDogZGlyc1xuICBjb25zdCB7XG4gICAgZmlsZURlcGVuZGVuY2llcyxcbiAgICBjb250ZXh0RGVwZW5kZW5jaWVzLFxuICB9ID0gX2dldEZpbGVBbmRDb250ZXh0RGVwcyhjb21waWxhdGlvbiwgZmlsZXMsIGRpcnMsIGN3ZCk7XG4gIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgZmlsZURlcGVuZGVuY2llcy5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICBjb21waWxhdGlvbi5maWxlRGVwZW5kZW5jaWVzLmFkZChwYXRoLnJlc29sdmUoZmlsZSkpO1xuICAgIH0pXG4gIH1cbiAgaWYgKGRpcnMubGVuZ3RoID4gMCkge1xuICAgIGNvbnRleHREZXBlbmRlbmNpZXMuZm9yRWFjaCgoY29udGV4dCkgPT4ge1xuICAgICAgY29tcGlsYXRpb24uY29udGV4dERlcGVuZGVuY2llcy5hZGQoY29udGV4dCk7XG4gICAgfSlcbiAgfVxufVxuXG5cbmZ1bmN0aW9uIF9nZXRGaWxlQW5kQ29udGV4dERlcHMoY29tcGlsYXRpb24sIGZpbGVzLCBkaXJzLCBjd2QpIHtcbiAgLy9jb25zdCBsb2cgPSByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2dcbiAgY29uc3QgdW5pcSA9IHJlcXVpcmUoJ2xvZGFzaC51bmlxJylcbiAgY29uc3QgaXNHbG9iID0gcmVxdWlyZSgnaXMtZ2xvYicpXG5cbiAgY29uc3QgeyBmaWxlRGVwZW5kZW5jaWVzLCBjb250ZXh0RGVwZW5kZW5jaWVzIH0gPSBjb21waWxhdGlvbjtcbiAgY29uc3QgaXNXZWJwYWNrNCA9IGNvbXBpbGF0aW9uLmhvb2tzO1xuICBsZXQgZmRzID0gaXNXZWJwYWNrNCA/IFsuLi5maWxlRGVwZW5kZW5jaWVzXSA6IGZpbGVEZXBlbmRlbmNpZXM7XG4gIGxldCBjZHMgPSBpc1dlYnBhY2s0ID8gWy4uLmNvbnRleHREZXBlbmRlbmNpZXNdIDogY29udGV4dERlcGVuZGVuY2llcztcbiAgaWYgKGZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICBmaWxlcy5mb3JFYWNoKChwYXR0ZXJuKSA9PiB7XG4gICAgICBsZXQgZiA9IHBhdHRlcm5cbiAgICAgIGlmIChpc0dsb2IocGF0dGVybikpIHtcbiAgICAgICAgZiA9IGdsb2Iuc3luYyhwYXR0ZXJuLCB7IGN3ZCwgZG90OiB0cnVlLCBhYnNvbHV0ZTogdHJ1ZSB9KVxuICAgICAgfVxuICAgICAgZmRzID0gZmRzLmNvbmNhdChmKVxuICAgIH0pXG4gICAgZmRzID0gdW5pcShmZHMpXG4gIH1cbiAgaWYgKGRpcnMubGVuZ3RoID4gMCkge1xuICAgIGNkcyA9IHVuaXEoY2RzLmNvbmNhdChkaXJzKSlcbiAgfVxuICByZXR1cm4geyBmaWxlRGVwZW5kZW5jaWVzOiBmZHMsIGNvbnRleHREZXBlbmRlbmNpZXM6IGNkcyB9XG59XG5cblxuXG5leHBvcnQgZnVuY3Rpb24gX3ByZXBhcmVGb3JCdWlsZChhcHAsIHZhcnMsIG9wdGlvbnMsIG91dHB1dCwgY29tcGlsYXRpb24pIHtcbiAgY29uc3QgbG9nID0gcmVxdWlyZSgnLi9wbHVnaW5VdGlsJykubG9nXG4gIGNvbnN0IGxvZ3YgPSByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2XG4gIGxvZ3Yob3B0aW9ucywnX3ByZXBhcmVGb3JCdWlsZCcpXG4gIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxuICBjb25zdCByZWN1cnNpdmVSZWFkU3luYyA9IHJlcXVpcmUoJ3JlY3Vyc2l2ZS1yZWFkZGlyLXN5bmMnKVxuICB2YXIgd2F0Y2hlZEZpbGVzPVtdXG4gIHRyeSB7d2F0Y2hlZEZpbGVzID0gcmVjdXJzaXZlUmVhZFN5bmMoJy4vYXBwJykuY29uY2F0KHJlY3Vyc2l2ZVJlYWRTeW5jKCcuL3BhY2thZ2VzJykpfVxuICBjYXRjaChlcnIpIHtpZihlcnIuZXJybm8gPT09IDM0KXtjb25zb2xlLmxvZygnUGF0aCBkb2VzIG5vdCBleGlzdCcpO30gZWxzZSB7dGhyb3cgZXJyO319XG4gIHZhciBjdXJyZW50TnVtRmlsZXMgPSB3YXRjaGVkRmlsZXMubGVuZ3RoXG4gIGxvZ3Yob3B0aW9ucywnd2F0Y2hlZEZpbGVzOiAnICsgY3VycmVudE51bUZpbGVzKVxuICB2YXIgZG9CdWlsZCA9IGZhbHNlXG4gIGZvciAodmFyIGZpbGUgaW4gd2F0Y2hlZEZpbGVzKSB7XG4gICAgaWYgKHZhcnMubGFzdE1pbGxpc2Vjb25kcyA8IGZzLnN0YXRTeW5jKHdhdGNoZWRGaWxlc1tmaWxlXSkubXRpbWVNcykge1xuICAgICAgaWYgKHdhdGNoZWRGaWxlc1tmaWxlXS5pbmRleE9mKFwic2Nzc1wiKSAhPSAtMSkge2RvQnVpbGQ9dHJ1ZTticmVhazt9XG4gICAgfVxuICB9XG4gIGlmICh2YXJzLmxhc3RNaWxsaXNlY29uZHMgPCBmcy5zdGF0U3luYygnLi9hcHAuanNvbicpLm10aW1lTXMpIHtcbiAgICBkb0J1aWxkPXRydWVcbiAgfVxuICBsb2d2KG9wdGlvbnMsJ2RvQnVpbGQ6ICcgKyBkb0J1aWxkKVxuXG4gIHZhcnMubGFzdE1pbGxpc2Vjb25kcyA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpXG4gIHZhciBmaWxlc291cmNlID0gJ3RoaXMgZmlsZSBlbmFibGVzIGNsaWVudCByZWxvYWQnXG4gIGNvbXBpbGF0aW9uLmFzc2V0c1tjdXJyZW50TnVtRmlsZXMgKyAnRmlsZXNVbmRlckFwcEZvbGRlci5tZCddID0ge1xuICAgIHNvdXJjZTogZnVuY3Rpb24oKSB7cmV0dXJuIGZpbGVzb3VyY2V9LFxuICAgIHNpemU6IGZ1bmN0aW9uKCkge3JldHVybiBmaWxlc291cmNlLmxlbmd0aH1cbiAgfVxuXG4gIC8vaWYob3B0aW9ucy52ZXJib3NlID09ICd5ZXMnKSB7bG9nKCctdi0nICsgYXBwICsgJ2N1cnJlbnROdW1GaWxlczogJyArIGN1cnJlbnROdW1GaWxlcyl9XG4gIC8vaWYob3B0aW9ucy52ZXJib3NlID09ICd5ZXMnKSB7bG9nKCctdi0nICsgYXBwICsgJ3ZhcnMubGFzdE51bUZpbGVzOiAnICsgdmFycy5sYXN0TnVtRmlsZXMpfVxuICAvL2lmKG9wdGlvbnMudmVyYm9zZSA9PSAneWVzJykge2xvZygnLXYtJyArIGFwcCArICdkb0J1aWxkOiAnICsgZG9CdWlsZCl9XG5cbiAgaWYgKGN1cnJlbnROdW1GaWxlcyAhPSB2YXJzLmxhc3ROdW1GaWxlcyB8fCBkb0J1aWxkKSB7XG4gICAgdmFycy5yZWJ1aWxkID0gdHJ1ZVxuICAgIGxvZyhhcHAgKyAnYnVpbGRpbmcgRXh0IGJ1bmRsZSBhdDogJyArIG91dHB1dC5yZXBsYWNlKHByb2Nlc3MuY3dkKCksICcnKSlcbiAgfVxuICBlbHNlIHtcbiAgICB2YXJzLnJlYnVpbGQgPSBmYWxzZVxuICB9XG4gIHZhcnMubGFzdE51bUZpbGVzID0gY3VycmVudE51bUZpbGVzXG59XG5cblxuXG5mdW5jdGlvbiB0b1h0eXBlKHN0cikge1xuICByZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXy9nLCAnLScpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0RnJvbVNvdXJjZShqcykge1xuICBjb25zdCBsb2cgPSByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2dcbiAgdmFyIGdlbmVyYXRlID0gcmVxdWlyZShcIkBiYWJlbC9nZW5lcmF0b3JcIikuZGVmYXVsdFxuICB2YXIgcGFyc2UgPSByZXF1aXJlKFwiYmFieWxvblwiKS5wYXJzZVxuICB2YXIgdHJhdmVyc2UgPSByZXF1aXJlKFwiYXN0LXRyYXZlcnNlXCIpXG4gIGNvbnN0IHN0YXRlbWVudHMgPSBbXVxuICBcbiAgY29uc3QgYXN0ID0gcGFyc2UoanMsIHtcbiAgICBwbHVnaW5zOiBbXG4gICAgICAnanN4JyxcbiAgICAgICdmbG93JyxcbiAgICAgICdkb0V4cHJlc3Npb25zJyxcbiAgICAgICdvYmplY3RSZXN0U3ByZWFkJyxcbiAgICAgICdjbGFzc1Byb3BlcnRpZXMnLFxuICAgICAgJ2V4cG9ydEV4dGVuc2lvbnMnLFxuICAgICAgJ2FzeW5jR2VuZXJhdG9ycycsXG4gICAgICAnZnVuY3Rpb25CaW5kJyxcbiAgICAgICdmdW5jdGlvblNlbnQnLFxuICAgICAgJ2R5bmFtaWNJbXBvcnQnXG4gICAgXSxcbiAgICBzb3VyY2VUeXBlOiAnbW9kdWxlJ1xuICB9KVxuXG4gIGZ1bmN0aW9uIGFkZFR5cGUoYXJnTm9kZSkge1xuICAgIHZhciB0eXBlXG4gICAgaWYgKGFyZ05vZGUudHlwZSA9PT0gJ1N0cmluZ0xpdGVyYWwnKSB7XG4gICAgICB2YXIgeHR5cGUgPSB0b1h0eXBlKGFyZ05vZGUudmFsdWUpXG4gICAgICBpZiAoeHR5cGUgIT0gJ2V4dHJlYWN0Jykge1xuICAgICAgICB0eXBlID0geyB4dHlwZTogdG9YdHlwZShhcmdOb2RlLnZhbHVlKSB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHR5cGUgPSB7IHhjbGFzczoganMuc2xpY2UoYXJnTm9kZS5zdGFydCwgYXJnTm9kZS5lbmQpIH1cbiAgICB9XG4gICAgaWYgKHR5cGUgIT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgY29uZmlnID0gSlNPTi5zdHJpbmdpZnkodHlwZSlcbiAgICAgIHN0YXRlbWVudHMucHVzaChgRXh0LmNyZWF0ZSgke2NvbmZpZ30pYClcbiAgICB9XG4gIH1cblxuICB0cmF2ZXJzZShhc3QsIHtcbiAgICBwcmU6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGlmIChub2RlLnR5cGUgPT09ICdDYWxsRXhwcmVzc2lvbidcbiAgICAgICAgICAmJiBub2RlLmNhbGxlZVxuICAgICAgICAgICYmIG5vZGUuY2FsbGVlLm9iamVjdFxuICAgICAgICAgICYmIG5vZGUuY2FsbGVlLm9iamVjdC5uYW1lID09PSAnRXh0J1xuICAgICAgKSB7XG4gICAgICAgIHN0YXRlbWVudHMucHVzaChnZW5lcmF0ZShub2RlKS5jb2RlKVxuICAgICAgfVxuICAgICAgaWYgKG5vZGUudHlwZSA9PSAnVmFyaWFibGVEZWNsYXJhdG9yJyBcbiAgICAgICAgICAmJiBub2RlLmluaXQgXG4gICAgICAgICAgJiYgbm9kZS5pbml0LnR5cGUgPT09ICdDYWxsRXhwcmVzc2lvbicgXG4gICAgICAgICAgJiYgbm9kZS5pbml0LmNhbGxlZSBcbiAgICAgICkge1xuICAgICAgICBpZiAobm9kZS5pbml0LmNhbGxlZS5uYW1lID09ICdyZWFjdGlmeScpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGUuaW5pdC5hcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlTm9kZSA9IG5vZGUuaW5pdC5hcmd1bWVudHNbaV07XG4gICAgICAgICAgICBpZiAoIXZhbHVlTm9kZSkgY29udGludWU7XG4gICAgICAgICAgICBhZGRUeXBlKHZhbHVlTm9kZSlcbiAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIC8vIENvbnZlcnQgUmVhY3QuY3JlYXRlRWxlbWVudCguLi4pIGNhbGxzIHRvIHRoZSBlcXVpdmFsZW50IEV4dC5jcmVhdGUoLi4uKSBjYWxscyB0byBwdXQgaW4gdGhlIG1hbmlmZXN0LlxuICAgICAgLy8gaWYgKG5vZGUudHlwZSA9PT0gJ0NhbGxFeHByZXNzaW9ueCcgXG4gICAgICAvLyAgICAgJiYgbm9kZS5jYWxsZWUub2JqZWN0IFxuICAgICAgLy8gICAgICYmIG5vZGUuY2FsbGVlLm9iamVjdC5uYW1lID09PSAnUmVhY3QnIFxuICAgICAgLy8gICAgICYmIG5vZGUuY2FsbGVlLnByb3BlcnR5Lm5hbWUgPT09ICdjcmVhdGVFbGVtZW50Jykge1xuICAgICAgLy8gICBjb25zdCBbcHJvcHNdID0gbm9kZS5hcmd1bWVudHNcbiAgICAgIC8vICAgbGV0IGNvbmZpZ1xuICAgICAgLy8gICBpZiAoQXJyYXkuaXNBcnJheShwcm9wcy5wcm9wZXJ0aWVzKSkge1xuICAgICAgLy8gICAgIGNvbmZpZyA9IGdlbmVyYXRlKHByb3BzKS5jb2RlXG4gICAgICAvLyAgICAgZm9yIChsZXQga2V5IGluIHR5cGUpIHtcbiAgICAgIC8vICAgICAgIGNvbmZpZyA9IGB7XFxuICAke2tleX06ICcke3R5cGVba2V5XX0nLCR7Y29uZmlnLnNsaWNlKDEpfWBcbiAgICAgIC8vICAgICB9XG4gICAgICAvLyAgIH0gZWxzZSB7XG4gICAgICAvLyAgICAgY29uZmlnID0gSlNPTi5zdHJpbmdpZnkodHlwZSlcbiAgICAgIC8vICAgfVxuICAgICAgLy8gfVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIHN0YXRlbWVudHNcbn1cbiJdfQ==